{"version":3,"sources":["../src/page.js"],"names":["wikiPage","get","rest","obj","first","firstValue","Object","keys","getFileName","text","indexOf","split","name","apiOptions","generator","gimlimit","prop","iiprop","titles","raw","title","then","res","query","pages","map","id","rvprop","rvsection","rawInfo","wikitext","parser","general","info","length","toLowerCase","_wikitext","key","metadata","hasOwnProperty","rawPageInfo","html","rvlimit","rvparse","pageid","revisions","content","explaintext","extract","summary","exintro","images","rawImages","image","imageinfo","reduce","imageInfos","list","url","references","ellimit","extlinks","link","links","plnamespace","pllimit","limit","aggregated","_pagination","categories","category","coordinates","page","data","backlinks","bllimit","bltitle","mainImage","Promise","all","bildname","imagen","Immagine","badge","logo","mainImageName","sort","b","a","find","filename","replace","langlinks","lllimit","lang","fullInfo","tables"],"mappings":"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","file":"page.js","sourcesContent":["import { aggregatePagination, pagination, api } from './util';\nimport infoboxParser from 'infobox-parser';\nimport { parseCoordinates } from './coordinates';\n\nconst get = (obj, first, ...rest) => {\n\tif (obj === undefined || first === undefined) return obj;\n\tif (typeof first === 'function') {\n\t\treturn get(first(obj), ...rest);\n\t}\n\treturn get(obj[first], ...rest);\n};\n\nconst firstValue = obj => {\n\tif (typeof obj === 'object') return obj[Object.keys(obj)[0]];\n\treturn obj[0];\n};\n\nconst getFileName = text => {\n\tif (!text) return undefined;\n\tif (text.indexOf(':') !== -1) {\n\t\tconst [, name] = text.split(':');\n\t\treturn name;\n\t}\n\treturn text;\n};\n\n/**\n * WikiPage\n * @namespace WikiPage\n */\nexport default function wikiPage(rawPageInfo, apiOptions) {\n\tconst raw = rawPageInfo;\n\n\t/**\n\t * HTML from page\n\t * @example\n\t * wiki.page('batman').then(page => page.html()).then(console.log);\n\t * @method WikiPage#html\n\t * @return {Promise}\n\t */\n\tfunction html() {\n\t\treturn api(apiOptions, {\n\t\t\tprop: 'revisions',\n\t\t\trvprop: 'content',\n\t\t\trvlimit: 1,\n\t\t\trvparse: '',\n\t\t\ttitles: raw.title\n\t\t}).then(res => res.query.pages[raw.pageid].revisions[0]['*']);\n\t}\n\n\t/**\n\t * Text content from page\n\t * @example\n\t * wiki.page('batman').then(page => page.content()).then(console.log);\n\t * @method WikiPage#content\n\t * @return {Promise}\n\t */\n\tfunction content() {\n\t\treturn api(apiOptions, {\n\t\t\tprop: 'extracts',\n\t\t\texplaintext: '',\n\t\t\ttitles: raw.title\n\t\t}).then(res => res.query.pages[raw.pageid].extract);\n\t}\n\n\t/**\n\t * Text summary from page\n\t * @example\n\t * wiki.page('batman').then(page => page.summary()).then(console.log);\n\t * @method WikiPage#summary\n\t * @return {Promise}\n\t */\n\tfunction summary() {\n\t\treturn api(apiOptions, {\n\t\t\tprop: 'extracts',\n\t\t\texplaintext: '',\n\t\t\texintro: '',\n\t\t\ttitles: raw.title\n\t\t}).then(res => res.query.pages[raw.pageid].extract);\n\t}\n\n\t/**\n\t * Raw data from images from page\n\t * @example\n\t * wiki.page('batman').then(page => page.rawImages()).then(console.log);\n\t * @method WikiPage#rawImages\n\t * @return {Promise}\n\t */\n\tfunction rawImages() {\n\t\treturn api(apiOptions, {\n\t\t\tgenerator: 'images',\n\t\t\tgimlimit: 'max',\n\t\t\tprop: 'imageinfo',\n\t\t\tiiprop: 'url',\n\t\t\ttitles: raw.title\n\t\t}).then(res => {\n\t\t\tif (res.query) {\n\t\t\t\treturn Object.keys(res.query.pages).map(id => res.query.pages[id]);\n\t\t\t}\n\t\t\treturn [];\n\t\t});\n\t}\n\n\t/**\n\t * Main image URL from infobox on page\n\t * @example\n\t * wiki.page('batman').then(page => page.mainImage()).then(console.log);\n\t * @method WikiPage#mainImage\n\t * @return {Promise}\n\t */\n\tfunction mainImage() {\n\t\treturn Promise.all([rawImages(), info()]).then(([images, info]) => {\n\t\t\t// Handle different translations of \"image\" here\n\t\t\tconst mainImageName = getFileName(\n\t\t\t\tinfo.image ||\n\t\t\t\t\tinfo.bildname ||\n\t\t\t\t\tinfo.imagen ||\n\t\t\t\t\tinfo.Immagine ||\n\t\t\t\t\tinfo.badge ||\n\t\t\t\t\tinfo.logo\n\t\t\t);\n\t\t\t// Handle case where no info box exists\n\t\t\tif (!mainImageName) {\n\t\t\t\treturn rawInfo().then(text => {\n\t\t\t\t\tif (!images.length) return undefined;\n\t\t\t\t\t// Sort images by what is seen first in page's info text\n\t\t\t\t\timages.sort((a, b) => text.indexOf(b.title) - text.indexOf(a.title));\n\t\t\t\t\tconst image = images[0];\n\t\t\t\t\treturn image.imageinfo.length > 0\n\t\t\t\t\t\t? image.imageinfo[0].url\n\t\t\t\t\t\t: undefined;\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst image = images.find(({ title }) => {\n\t\t\t\tconst filename = getFileName(title);\n\t\t\t\t// Some wikis use underscores for spaces, some don't\n\t\t\t\treturn (\n\t\t\t\t\tfilename === mainImageName ||\n\t\t\t\t\tfilename.replace(/\\s/g, '_') === mainImageName\n\t\t\t\t);\n\t\t\t});\n\t\t\treturn image && image.imageinfo.length > 0\n\t\t\t\t? image.imageinfo[0].url\n\t\t\t\t: undefined;\n\t\t});\n\t}\n\n\t/**\n\t * Image URL's from page\n\t * @example\n\t * wiki.page('batman').then(page => page.image()).then(console.log);\n\t * @method WikiPage#images\n\t * @return {Promise}\n\t */\n\tfunction images() {\n\t\treturn rawImages().then(images => {\n\t\t\treturn images\n\t\t\t\t.map(image => image.imageinfo)\n\t\t\t\t.reduce((imageInfos, list) => [...imageInfos, ...list], [])\n\t\t\t\t.map(info => info.url);\n\t\t});\n\t}\n\n\t/**\n\t * References from page\n\t * @example\n\t * wiki.page('batman').then(page => page.references()).then(console.log);\n\t * @method WikiPage#references\n\t * @return {Promise}\n\t */\n\tfunction references() {\n\t\treturn api(apiOptions, {\n\t\t\tprop: 'extlinks',\n\t\t\tellimit: 'max',\n\t\t\ttitles: raw.title\n\t\t}).then(res => res.query.pages[raw.pageid].extlinks.map(link => link['*']));\n\t}\n\n\t/**\n\t * Paginated links from page\n\t * @example\n\t * wiki.page('batman').then(page => page.links()).then(console.log);\n\t * @method WikiPage#links\n\t * @param  {Boolean} [aggregated] - return all links (default is true)\n\t * @param  {Number} [limit] - number of links per page\n\t * @return {Promise} - returns results if aggregated [and next function for more results if not aggregated]\n\t */\n\tfunction links(aggregated = true, limit = 100) {\n\t\tconst _pagination = pagination(\n\t\t\tapiOptions,\n\t\t\t{\n\t\t\t\tprop: 'links',\n\t\t\t\tplnamespace: 0,\n\t\t\t\tpllimit: limit,\n\t\t\t\ttitles: raw.title\n\t\t\t},\n\t\t\tres => res.query.pages[raw.pageid].links.map(link => link.title)\n\t\t);\n\t\tif (aggregated) {\n\t\t\treturn aggregatePagination(_pagination);\n\t\t}\n\t\treturn _pagination;\n\t}\n\n\t/**\n\t * Paginated categories from page\n\t * @example\n\t * wiki.page('batman').then(page => page.categories()).then(console.log);\n\t * @method WikiPage#categories\n\t * @param  {Boolean} [aggregated] - return all categories (default is true)\n\t * @param  {Number} [limit] - number of categories per page\n\t * @return {Promise} - returns results if aggregated [and next function for more results if not aggregated]\n\t */\n\tfunction categories(aggregated = true, limit = 100) {\n\t\tconst _pagination = pagination(\n\t\t\tapiOptions,\n\t\t\t{\n\t\t\t\tprop: 'categories',\n\t\t\t\tpllimit: limit,\n\t\t\t\ttitles: raw.title\n\t\t\t},\n\t\t\tres =>\n\t\t\t\tres.query.pages[raw.pageid].categories.map(category => category.title)\n\t\t);\n\t\tif (aggregated) {\n\t\t\treturn aggregatePagination(_pagination);\n\t\t}\n\t\treturn _pagination;\n\t}\n\n\t/**\n\t * Geographical coordinates from page\n\t * @example\n\t * wiki().page('Texas').then(texas => texas.coordinates())\n\t * @method WikiPage#coordinates\n\t * @return {Promise}\n\t */\n\tfunction coordinates() {\n\t\treturn api(apiOptions, {\n\t\t\tprop: 'coordinates',\n\t\t\ttitles: raw.title\n\t\t}).then(res => {\n\t\t\tconst page = res.query.pages[raw.pageid];\n\t\t\tif (page.coordinates) {\n\t\t\t\treturn page.coordinates[0];\n\t\t\t}\n\t\t\t// No coordinates for this page, check infobox for deprecated version\n\t\t\treturn info().then(data => parseCoordinates(data));\n\t\t});\n\t}\n\n\tfunction rawInfo(title) {\n\t\treturn api(apiOptions, {\n\t\t\tprop: 'revisions',\n\t\t\trvprop: 'content',\n\t\t\trvsection: 0,\n\t\t\ttitles: title || raw.title\n\t\t}).then(res => get(res, 'query', 'pages', firstValue, 'revisions', 0, '*'));\n\t}\n\n\t/**\n\t * Fetch and parse tables within page\n\t * @return {Array} Collection of tables\n\t */\n\tfunction tables() {\n\t\treturn api(apiOptions, {\n\t\t\tprop: 'revisions',\n\t\t\trvprop: 'content',\n\t\t\ttitles: raw.title\n\t\t})\n\t\t\t.then(res => get(res, 'query', 'pages', firstValue, 'revisions', 0, '*'))\n\t\t\t.then(wikitext => infoboxParser(wikitext, apiOptions.parser).tables);\n\t}\n\n\t/**\n\t * Get general information from page, with optional specifc property\n\t * @deprecated This method will be dropped and replaced with the `fullInfo` implementation in v5\n\t * @example\n\t * new Wiki().page('Batman').then(page => page.info('alter_ego'));\n\t * @method WikiPage#info\n\t * @param  {String} [key] - Information key. Falsy keys are ignored\n\t * @return {Promise} - info Object contains key/value pairs of infobox data, or specific value if key given\n\t */\n\tfunction info(key) {\n\t\treturn rawInfo()\n\t\t\t.then(wikitext => {\n\t\t\t\t// Use general data for now...\n\t\t\t\tconst info = infoboxParser(wikitext, apiOptions.parser).general;\n\t\t\t\tif (Object.keys(info).length === 0) {\n\t\t\t\t\t// If empty, check to see if this page has a templated infobox\n\t\t\t\t\treturn rawInfo(`Template:Infobox ${raw.title.toLowerCase()}`).then(\n\t\t\t\t\t\t_wikitext =>\n\t\t\t\t\t\t\tinfoboxParser(_wikitext || '', apiOptions.parser).general\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn info;\n\t\t\t})\n\t\t\t.then(metadata => {\n\t\t\t\tif (!key) {\n\t\t\t\t\treturn metadata;\n\t\t\t\t}\n\t\t\t\tif (metadata.hasOwnProperty(key)) {\n\t\t\t\t\treturn metadata[key];\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Get the full infobox data, parsed in a easy to use manner\n\t * @example\n\t * new Wiki().page('Batman').then(page => page.fullInfo()).then(info => info.general.aliases);\n\t * @method WikiPage#fullInfo\n\t * @return {Promise} - Parsed object of all infobox data\n\t */\n\tfunction fullInfo() {\n\t\treturn rawInfo().then(wikitext =>\n\t\t\tinfoboxParser(wikitext, apiOptions.parser)\n\t\t);\n\t}\n\n\t/**\n\t * Paginated backlinks from page\n\t * @method WikiPage#backlinks\n\t * @param  {Boolean} [aggregated] - return all backlinks (default is true)\n\t * @param  {Number} [limit] - number of backlinks per page\n\t * @return {Promise} - includes results [and next function for more results if not aggregated]\n\t */\n\tfunction backlinks(aggregated = true, limit = 100) {\n\t\tconst _pagination = pagination(\n\t\t\tapiOptions,\n\t\t\t{\n\t\t\t\tlist: 'backlinks',\n\t\t\t\tbllimit: limit,\n\t\t\t\tbltitle: raw.title\n\t\t\t},\n\t\t\tres => res.query.backlinks.map(link => link.title)\n\t\t);\n\t\tif (aggregated) {\n\t\t\treturn aggregatePagination(_pagination);\n\t\t}\n\t\treturn _pagination;\n\t}\n\n\t/**\n\t * Get list of links to different translations\n\t * @method WikiPage#langlinks\n\t * @return {Promise} - includes link objects { lang, title }\n\t */\n\tfunction langlinks() {\n\t\treturn api(apiOptions, {\n\t\t\tprop: 'langlinks',\n\t\t\tlllimit: 'max',\n\t\t\ttitles: raw.title\n\t\t}).then(res =>\n\t\t\tres.query.pages[raw.pageid].langlinks.map(link => {\n\t\t\t\treturn {\n\t\t\t\t\tlang: link.lang,\n\t\t\t\t\ttitle: link['*']\n\t\t\t\t};\n\t\t\t})\n\t\t);\n\t}\n\n\tconst page = {\n\t\traw,\n\t\thtml,\n\t\tcontent,\n\t\tsummary,\n\t\timages,\n\t\treferences,\n\t\tlinks,\n\t\tcategories,\n\t\tcoordinates,\n\t\tinfo,\n\t\tbacklinks,\n\t\trawImages,\n\t\tmainImage,\n\t\tlanglinks,\n\t\trawInfo,\n\t\tfullInfo,\n\t\ttables\n\t};\n\n\treturn page;\n}\n"]}