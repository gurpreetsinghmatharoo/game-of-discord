'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _slicedToArray=function(){function c(d,e){var f=[],g=!0,h=!1,j=void 0;try{for(var l,k=d[Symbol.iterator]();!(g=(l=k.next()).done)&&(f.push(l.value),!(e&&f.length===e));g=!0);}catch(m){h=!0,j=m}finally{try{!g&&k['return']&&k['return']()}finally{if(h)throw j}}return f}return function(d,e){if(Array.isArray(d))return d;if(Symbol.iterator in Object(d))return c(d,e);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&'function'==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?'symbol':typeof c};exports.default=wikiPage;var _util=require('./util'),_infoboxParser=require('infobox-parser'),_infoboxParser2=_interopRequireDefault(_infoboxParser),_coordinates=require('./coordinates');function _interopRequireDefault(c){return c&&c.__esModule?c:{default:c}}function _toConsumableArray(c){if(Array.isArray(c)){for(var d=0,e=Array(c.length);d<c.length;d++)e[d]=c[d];return e}return Array.from(c)}var get=function(c,d){for(var e=arguments.length,f=Array(2<e?e-2:0),g=2;g<e;g++)f[g-2]=arguments[g];return void 0===c||void 0===d?c:'function'==typeof d?get.apply(void 0,[d(c)].concat(f)):get.apply(void 0,[c[d]].concat(f))},firstValue=function(c){return'object'===('undefined'==typeof c?'undefined':_typeof(c))?c[Object.keys(c)[0]]:c[0]},getFileName=function(c){if(c){if(-1!==c.indexOf(':')){var d=c.split(':'),e=_slicedToArray(d,2),f=e[1];return f}return c}};function wikiPage(c,d){function h(){return(0,_util.api)(d,{generator:'images',gimlimit:'max',prop:'imageinfo',iiprop:'url',titles:v.title}).then(function(x){return x.query?Object.keys(x.query.pages).map(function(y){return x.query.pages[y]}):[]})}function p(x){return(0,_util.api)(d,{prop:'revisions',rvprop:'content',rvsection:0,titles:x||v.title}).then(function(y){return get(y,'query','pages',firstValue,'revisions',0,'*')})}function r(x){return p().then(function(y){var z=(0,_infoboxParser2.default)(y,d.parser).general;return 0===Object.keys(z).length?p('Template:Infobox '+v.title.toLowerCase()).then(function(A){return(0,_infoboxParser2.default)(A||'',d.parser).general}):z}).then(function(y){return x?y.hasOwnProperty(x)?y[x]:void 0:y})}var v=c;return{raw:v,html:function(){return(0,_util.api)(d,{prop:'revisions',rvprop:'content',rvlimit:1,rvparse:'',titles:v.title}).then(function(x){return x.query.pages[v.pageid].revisions[0]['*']})},content:function(){return(0,_util.api)(d,{prop:'extracts',explaintext:'',titles:v.title}).then(function(x){return x.query.pages[v.pageid].extract})},summary:function(){return(0,_util.api)(d,{prop:'extracts',explaintext:'',exintro:'',titles:v.title}).then(function(x){return x.query.pages[v.pageid].extract})},images:function(){return h().then(function(x){return x.map(function(y){return y.imageinfo}).reduce(function(y,z){return[].concat(_toConsumableArray(y),_toConsumableArray(z))},[]).map(function(y){return y.url})})},references:function(){return(0,_util.api)(d,{prop:'extlinks',ellimit:'max',titles:v.title}).then(function(x){return x.query.pages[v.pageid].extlinks.map(function(y){return y['*']})})},links:function(){var x=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,y=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,z=(0,_util.pagination)(d,{prop:'links',plnamespace:0,pllimit:y,titles:v.title},function(A){return A.query.pages[v.pageid].links.map(function(B){return B.title})});return x?(0,_util.aggregatePagination)(z):z},categories:function(){var x=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,y=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,z=(0,_util.pagination)(d,{prop:'categories',pllimit:y,titles:v.title},function(A){return A.query.pages[v.pageid].categories.map(function(B){return B.title})});return x?(0,_util.aggregatePagination)(z):z},coordinates:function(){return(0,_util.api)(d,{prop:'coordinates',titles:v.title}).then(function(x){var y=x.query.pages[v.pageid];return y.coordinates?y.coordinates[0]:r().then(function(z){return(0,_coordinates.parseCoordinates)(z)})})},info:r,backlinks:function(){var x=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,y=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,z=(0,_util.pagination)(d,{list:'backlinks',bllimit:y,bltitle:v.title},function(A){return A.query.backlinks.map(function(B){return B.title})});return x?(0,_util.aggregatePagination)(z):z},rawImages:h,mainImage:function(){return Promise.all([h(),r()]).then(function(x){var y=_slicedToArray(x,2),z=y[0],A=y[1],B=getFileName(A.image||A.bildname||A.imagen||A.Immagine||A.badge||A.logo);if(!B)return p().then(function(D){if(z.length){z.sort(function(F,G){return D.indexOf(G.title)-D.indexOf(F.title)});var E=z[0];return 0<E.imageinfo.length?E.imageinfo[0].url:void 0}});var C=z.find(function(D){var E=D.title,F=getFileName(E);return F===B||F.replace(/\s/g,'_')===B});return C&&0<C.imageinfo.length?C.imageinfo[0].url:void 0})},langlinks:function(){return(0,_util.api)(d,{prop:'langlinks',lllimit:'max',titles:v.title}).then(function(x){return x.query.pages[v.pageid].langlinks.map(function(y){return{lang:y.lang,title:y['*']}})})},rawInfo:p,fullInfo:function(){return p().then(function(x){return(0,_infoboxParser2.default)(x,d.parser)})},tables:function(){return(0,_util.api)(d,{prop:'revisions',rvprop:'content',titles:v.title}).then(function(x){return get(x,'query','pages',firstValue,'revisions',0,'*')}).then(function(x){return(0,_infoboxParser2.default)(x,d.parser).tables})}}}
//# sourceMappingURL=page.js.map